{% extends "front/base.html.twig" %}
{% block stylesheets %}
    <style>

        .dashboard-row {
            width: 100%;
            display: table;
        }

        .dashboard-row > div {
            display: inline-block;
        }

        .dashboard-header > div {
            display: inline-block;
        }

        .dashboard-row:not(.w-full) {
            display: table-row;
        }

        .dashboard-row:not(.w-full) > div {
            display: table-cell;
        }

        .dashboard-row:not(.w-full) > div:nth-child(1),
        .dashboard-row:not(.w-full) > div:nth-child(2),
        .dashboard-row:not(.w-full) > div:nth-child(4),
        .dashboard-row:not(.w-full) > div:nth-child(5),
        .dashboard-row:not(.w-full) > div:nth-child(6),
        .dashboard-row:not(.w-full) > div:nth-child(9),
        .dashboard-row:not(.w-full) > div:nth-child(10) {
            display: none;
        }

        .dashboard-row:not(.w-full) > div:nth-child(4) {
            width: 20% !important;
        }

        .dashboard-row:not(.w-full) > div:nth-child(7) {
            width: 10% !important;
        }

        .dashboard-row:not(.w-full) > div:nth-child(7) span a {
            text-decoration: none;
            color: black;
            cursor: default;
        }

        .dashboard-row:not(.w-full) > div:nth-child(8) {
            width: 10% !important;
        }

    </style>
{% endblock %}
{% block title %}
    Réservation pour le spectacle {{ show.name }}
{% endblock %}
{% block body %}
    <div class="banner">
        {% if show.banner is defined and show.banner %}
            {% include 'front/incs/banner_picture.html.twig' with { banner:  show.banner, alt: show.name } %}
        {% else %}
            <img src="{{ sonata_path(get_content('show_details_default_banner'), 'banner') }}" alt="">
        {% endif %}
        <div class="banner-content container-fluid">
            <div class="row flex-column align-items-center justify-content-center">
                <h2 class="banner-title">{{ show.name }}</h2>
                {% if show.punchline %}
                    <h3 class="mb-4">{{ show.punchline }}</h3>
                {% endif %}
            </div>
        </div>
    </div>
    <header class="container mt-5">
        <h1>Réservations pour le spectacle <em>{{ show.name }}</em></h1>
    </header>
    {% if is_granted('ROLE_INSIGHT_SHOW_VIEW', show) and insights %}
        <section class="container" id="show-billetreduc">
            <h2>Réservations billetreduc</h2>
            {% for i in insights %}
                {{ i.html | raw }}
                <p class="mt-5">
                    Mis à jour le {{ i.createdAt | date("d/m/Y à H:i", "Europe/Paris") }}
                </p>
            {% endfor %}
            <script>

                document.addEventListener('DOMContentLoaded', () => {
                    document.querySelectorAll('.dashboard-row a').forEach((el) => {
                        el.addEventListener('click', (evt) => {
                            evt.preventDefault();
                            return false;
                        });
                    })
                });
            </script>
        </section>
    {% endif %}
    <section id="show-performances" class="container">
        <h2 class="mb-4">Réservations sur le site</h2>
        <div class="row">
            {% for p in available_performances %}
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-header">
                            {{ p.performedAt | date('d') }} {{ p.performedAt | date('F') | trans }}
                            à {{ p.performedAt | date('H:i') }}
                        </div>
                        <div class="card-body">
                            {% if p.isAvailableForReservation %}
                                <p class="card-text">Réservez dès à présent pour cette date en cliquant sur le bouton
                                    ci-dessous</p>
                                <a href="{{ path("app_reservation_form", {id: p.id}) }}" class="btn btn-primary me-2">Réserver</a>
                            {% else %}
                                <p class="card-text">Cette représentation n'est plus disponible à la réservation.</p>
                            {% endif %}
                            {% if is_granted('SHOW_LIST_RESERVATION', p.relatedProject) %}
                                <a href="{{ path("app_reservation_view", {id: p.id}) }}">Voir les réservations</a>
                            {% endif %}
                        </div>
                        <div class="card-footer text-muted">
                            {{ p.availableReservationsSum }} place(s) restante(s) sur {{ p.quota }}
                        </div>
                    </div>
                </div>
            {% else %}
                <p>Aucune date n'est disponible pour l'instant.</p>
            {% endfor %}
        </div>
        <a href="{{ path("app_show_details", {slug: show.slug}) }}" class="btn btn-outline-success mt-4">Revenir au spectacle</a>
    </section>
{% endblock %}